{"version":3,"names":["phoneRef","common_vendor","ref","common_storage","getUserInfo","phone","index","$on","value","onUnmounted","$off","finishGetPhoneNumber","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","params","_params$detail","errMsg","code","userInfo","wrap","_callee$","_context","prev","next","showLoading","title","detail","abrupt","api_user","user","bindPhoneWechat","sent","setUserInfo","_objectSpread2","hideLoading","stop","_x","apply","arguments","wx","createComponent","Component"],"sources":["phone.vue","phone.vue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"phone-wrapper\">\r\n\t\t<slot></slot>-{{ !phoneRef.value }}-\r\n\t\t<button v-if=\"!phoneRef\"\r\n\t\t\tclass=\"overlay-button\" \r\n\t\t\topen-type=\"getPhoneNumber\" \r\n\t\t\t@getphonenumber=\"finishGetPhoneNumber\"\r\n\t\t>ff</button>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref,onUnmounted } from 'vue'\r\nimport { user } from '@/api'\r\nimport {getUserInfo,setUserInfo} from '@/common/storage'\r\n\r\nconst phoneRef = ref(getUserInfo().phone);\r\n\r\n// 监听storage变化\r\nuni.$on('storage-changed', () => {\r\n    phoneRef.value = getUserInfo().phone;\r\n})\r\n\r\n// 组件卸载时移除事件监听\r\nonUnmounted(() => {\r\n    uni.$off('storage-changed')\r\n})\r\n\r\n\t\t\t\r\n\t\t\t\t\t\tconst finishGetPhoneNumber = async(params) => {\r\n\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\ttitle: '绑定手机号中...'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconst { detail: { errMsg, code, } } = params;\r\n\t\t\t\r\n\t\t\t\t\t\t\tif (errMsg === 'getPhoneNumber:fail user deny') {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\t\t\tconst userInfo = await user.bindPhoneWechat(code);\r\n\t\t\t\t\t\t\tdebugger\r\n\t\t\t\t\t\t\tsetUserInfo({\r\n\t\t\t\t\t\t\t\t...getUserInfo(),\r\n\t\t\t\t\t\t\t\tphone: userInfo.phone\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.phone-wrapper {\r\n\tposition: relative;\r\n}\r\n\r\n.overlay-button {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\topacity: 0;\r\n\tz-index: 1;\r\n}\r\n</style>\r\n","import Component from '/Users/wangshuli/workspace/mine/pighand/pighand-AIO/uni-app/components/user/phone.vue'\nwx.createComponent(Component)"],"mappings":";;;;;;;;;;;;IAgBA,IAAMA,QAAA,GAAWC,aAAA,CAAGC,GAAA,CAACC,cAAA,CAAAC,WAAA,EAAa,CAACC,KAAK;IAGxCJ,aAAA,CAAAK,KAAA,CAAIC,GAAA,CAAI,mBAAmB,YAAM;MAC7BP,QAAA,CAASQ,KAAA,GAAQL,cAAA,CAAAC,WAAA,EAAa,CAACC,KAAA;IACnC,CAAC;IAGDJ,aAAA,CAAAQ,WAAA,CAAY,YAAM;MACdR,aAAA,CAAGK,KAAA,CAACI,IAAA,CAAK,iBAAiB;IAC9B,CAAC;IAGK,IAAMC,oBAAA;MAAA,IAAAC,IAAA,GAAAC,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAuB,SAAAC,QAAMC,MAAA;QAAA,IAAAC,cAAA,EAAAC,MAAA,EAAAC,IAAA,EAAAC,QAAA;QAAA,OAAAP,oBAAA,GAAAQ,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAClCzB,aAAA,CAAAK,KAAA,CAAIqB,WAAA,CAAY;gBACfC,KAAA,EAAO;cACf,CAAQ;cAAAV,cAAA,GACqCD,MAAA,CAA9BY,MAAA,EAAUV,MAAA,GAAAD,cAAA,CAAAC,MAAA,EAAQC,IAAA,GAAAF,cAAA,CAAAE,IAAA;cAAA,MAEtBD,MAAA,KAAW;gBAAAK,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAA,OAAAF,QAAA,CAAAM,MAAA;YAAA;cAAAN,QAAA,CAAAE,IAAA;cAAA,OAIQK,QAAA,CAAAC,IAAA,CAAKC,eAAA,CAAgBb,IAAI;YAAA;cAA1CC,QAAA,GAAAG,QAAA,CAAAU,IAAA;cACN;cACA/B,cAAA,CAAAgC,WAAA,CAAAC,cAAA,CAAAA,cAAA,KACIjC,cAAA,CAAAC,WAAA,EAAa;gBAChBC,KAAA,EAAOgB,QAAA,CAAShB;cAAA,GAChB;cACDJ,aAAA,CAAGK,KAAA,CAAC+B,WAAA,EAAW;YAAA;YAAA;cAAA,OAAAb,QAAA,CAAAc,IAAA;UAAA;QAAA,GAAAtB,OAAA;MAAA,CACf;MAAA,gBAjBKL,qBAAA4B,EAAA;QAAA,OAAA3B,IAAA,CAAA4B,KAAA,OAAAC,SAAA;MAAA;IAAA,GAiBL;;;;;;;;;;;;AC7CPC,EAAA,CAAGC,eAAA,CAAgBC,SAAS","ignoreList":[]}