{"version":3,"names":["statistics","common_vendor","ref","recordsList","loading","statusLabels","frozenAmount","settledAmount","withdrawAmount","refundAmount","typeLabels","getTypeLabel","type","getTypeClass","classMap","getAmountClass","formatTime","timeStr","date","Date","concat","getFullYear","String","getMonth","padStart","getDate","getHours","getMinutes","getSafeNumber","value","_typeof2","Number","numValue2","isNaN","numValue","formatAmount","amount","safeAmount","Decimal","dividedBy","toFixed","formatRecordAmount","record","totalAmount","plus","loadStatistics","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","defaultStatistics","processedRes","wrap","_callee$","_context","prev","next","api_distribution","distributionAPI","sent","Object","keys","reduce","acc","key","_objectSpread2","Math","abs","stop","apply","arguments","loadRecords","_ref2","_callee2","_callee2$","_context2","querySales","records","initData","_ref3","_callee3","_callee3$","_context3","Promise","all","onLoad","onShow","wx","createPage","MiniProgramPage"],"sources":["distribution-list.vue","distribution-list.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"distribution-list\">\r\n    <custom-navigation-bar :back=\"true\" position=\"flex\" title=\"分销记录\" />\r\n    \r\n    <!-- 统计信息 -->\r\n    <view class=\"statistics-section\">\r\n      <view class=\"statistics-grid\">\r\n        <view class=\"stat-item\" v-for=\"(value, key) in statistics\" :key=\"key\">\r\n          <view class=\"stat-value\">{{ formatAmount(value) }}</view>\r\n          <view class=\"stat-label\">{{ statusLabels[key] }}</view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 记录列表 -->\r\n    <view class=\"records-section\">\r\n      <view class=\"records-title\">分销记录</view>\r\n      <view class=\"records-list\">\r\n        <view class=\"record-item\" v-for=\"record in recordsList\" :key=\"record.id\">\r\n          <view class=\"record-header\">\r\n            <view class=\"order-sn\">订单号：{{ record.order?.sn || '-' }}</view>\r\n            <view class=\"record-time\">{{ formatTime(record.createdAt) }}</view>\r\n          </view>\r\n          <view class=\"record-content\">\r\n            <view class=\"record-info\">\r\n              <view class=\"record-type\" :class=\"getTypeClass(record.type)\">{{ getTypeLabel(record.type) }}</view>\r\n            </view>\r\n            <view class=\"record-amount\" :class=\"getAmountClass(record.type)\">\r\n              <text class=\"currency-symbol\">￥</text>\r\n              <text class=\"amount-number\">{{ formatRecordAmount(record) }}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- 空状态 -->\r\n      <view v-if=\"recordsList.length === 0 && !loading\" class=\"empty-state\">\r\n        <text>暂无分销记录</text>\r\n      </view>\r\n      \r\n      <!-- 加载状态 -->\r\n      <view v-if=\"loading\" class=\"loading-state\">\r\n        <text>加载中...</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport Decimal from 'decimal.js'\r\nimport { onLoad, onShow } from '@dcloudio/uni-app'\r\nimport { distribution as distributionAPI } from '@/api'\r\n\r\n// 响应式数据\r\nconst statistics = ref({})\r\nconst recordsList = ref([])\r\nconst loading = ref(false)\r\n\r\n// 状态标签映射\r\nconst statusLabels = {\r\n  frozenAmount: '冻结中',\r\n  settledAmount: '待结算',\r\n  withdrawAmount: '已结算',\r\n  refundAmount: '退款'\r\n}\r\n\r\n// 类型标签映射\r\nconst typeLabels = {\r\n  10: '分销',\r\n  20: '结算'\r\n}\r\n\r\n// 获取类型标签\r\nconst getTypeLabel = (type) => {\r\n  return typeLabels[type] || '未知类型'\r\n}\r\n\r\n// 获取类型样式类\r\nconst getTypeClass = (type) => {\r\n  const classMap = {\r\n    10: 'type-sales',\r\n    20: 'type-settlement'\r\n  }\r\n  return classMap[type] || ''\r\n}\r\n\r\n// 获取状态样式类\r\nconst getStatusClass = (status) => {\r\n  const classMap = {\r\n    0: 'status-frozen',\r\n    10: 'status-pending',\r\n    20: 'status-settled',\r\n    90: 'status-refund'\r\n  }\r\n  return classMap[status] || ''\r\n}\r\n\r\n// 获取金额样式类\r\nconst getAmountClass = (type) => {\r\n  if (type === 10) return 'amount-sales'\r\n  if (type === 20) return 'amount-settlement'\r\n  return ''\r\n}\r\n\r\n// 格式化时间\r\nconst formatTime = (timeStr) => {\r\n  if (!timeStr) return '-'\r\n  const date = new Date(timeStr)\r\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`\r\n}\r\n\r\n// 安全获取数值，处理响应式对象(Proxy)和其他特殊情况\r\nconst getSafeNumber = (value) => {\r\n  if (value === null || value === undefined) return 0\r\n  \r\n  // 处理响应式对象(Proxy)\r\n  if (typeof value === 'object' && value !== null) {\r\n    // 如果是ref对象，获取.value\r\n    if (value.value !== undefined) {\r\n      return Number(value.value) || 0\r\n    }\r\n    // 尝试转换为数字\r\n    const numValue = Number(value)\r\n    return isNaN(numValue) ? 0 : numValue\r\n  }\r\n  \r\n  // 直接转换为数字\r\n  const numValue = Number(value)\r\n  return isNaN(numValue) ? 0 : numValue\r\n}\r\n\r\n// 格式化金额（分转元）\r\nconst formatAmount = (amount) => {\r\n  const safeAmount = getSafeNumber(amount)\r\n  return new Decimal(safeAmount).dividedBy(100).toFixed(2)\r\n}\r\n\r\n// 格式化记录金额\r\nconst formatRecordAmount = (record) => {\r\n  const frozenAmount = getSafeNumber(record.frozenAmount)\r\n  const settledAmount = getSafeNumber(record.settledAmount)\r\n  const refundAmount = getSafeNumber(record.refundAmount)\r\n  \r\n  const totalAmount = new Decimal(frozenAmount)\r\n    .plus(settledAmount)\r\n    .plus(refundAmount)\r\n  return totalAmount.dividedBy(100).toFixed(2)\r\n}\r\n\r\n// 加载统计数据\r\nconst loadStatistics = async () => {\r\n  const res = await distributionAPI.statistics()\r\n  \r\n  // 基于statusLabels动态创建默认值对象\r\n  const defaultStatistics = Object.keys(statusLabels).reduce((acc, key) => {\r\n    acc[key] = 0\r\n    return acc\r\n  }, {})\r\n\r\n  const processedRes = res ? { ...res } : {}\r\n  \r\n  // 将已结算金额的负数转为正数\r\n  if (processedRes.withdrawAmount && processedRes.withdrawAmount < 0) {\r\n    processedRes.withdrawAmount = Math.abs(processedRes.withdrawAmount)\r\n  }\r\n\r\n  statistics.value = {\r\n    ...defaultStatistics,\r\n    ...processedRes\r\n  }\r\n}\r\n\r\n// 加载记录列表\r\nconst loadRecords = async () => {\r\n    loading.value = true\r\n    const res = await distributionAPI.querySales()\r\n\r\n    recordsList.value = res?.records || []\r\n    loading.value = false\r\n}\r\n\r\n// 初始化数据\r\nconst initData = async () => {\r\n  await Promise.all([\r\n    loadStatistics(),\r\n    loadRecords()\r\n  ])\r\n}\r\n\r\n// 页面生命周期\r\nonLoad(() => {\r\n  initData()\r\n})\r\n\r\nonShow(() => {\r\n  initData()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.distribution-list {\r\n  padding: 20rpx;\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n/* 统计信息样式 */\r\n.statistics-section {\r\n  background: white;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.statistics-grid {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 20rpx;\r\n}\r\n\r\n.stat-item {\r\n  flex: 1;\r\n  min-width: 0;\r\n  text-align: center;\r\n  padding: 20rpx;\r\n  background: #f8f9fa;\r\n  border-radius: 12rpx;\r\n}\r\n\r\n.stat-value {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #007aff;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.stat-label {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n  font-weight: normal;\r\n}\r\n\r\n/* 记录列表样式 */\r\n.records-section {\r\n  background: white;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n}\r\n\r\n.records-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.record-item {\r\n  padding: 30rpx 0;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.record-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.record-header {\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.order-sn {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  font-weight: 500;\r\n}\r\n\r\n.record-time {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  margin-top: 10rpx;\r\n}\r\n\r\n.record-content {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.record-info {\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.record-type {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n  padding: 8rpx 16rpx;\r\n  background: #f0f0f0;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.type-sales {\r\n  color: #007aff;\r\n  background: #e3f2fd;\r\n}\r\n\r\n.type-settlement {\r\n  color: #ff6b35;\r\n  background: #fff3e0;\r\n}\r\n\r\n.record-status {\r\n  font-size: 24rpx;\r\n  padding: 8rpx 16rpx;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.status-frozen {\r\n  color: #ff9500;\r\n  background: #fff3e0;\r\n}\r\n\r\n.status-pending {\r\n  color: #007aff;\r\n  background: #e3f2fd;\r\n}\r\n\r\n.status-settled {\r\n  color: #34c759;\r\n  background: #e8f5e8;\r\n}\r\n\r\n.status-refund {\r\n  color: #ff3b30;\r\n  background: #ffebee;\r\n}\r\n\r\n.record-amount {\r\n  display: flex;\r\n  align-items: baseline;\r\n  color: #333;\r\n}\r\n\r\n.currency-symbol {\r\n  font-size: 24rpx;\r\n  font-weight: normal;\r\n  margin-right: 4rpx;\r\n}\r\n\r\n.amount-number {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n}\r\n\r\n.record-amount.amount-sales .amount-number {\r\n  color: #ff3b30;\r\n}\r\n\r\n.record-amount.amount-settlement .amount-number {\r\n  color: #34c759;\r\n}\r\n\r\n/* 空状态和加载状态 */\r\n.empty-state,\r\n.loading-state {\r\n  text-align: center;\r\n  padding: 80rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/wangshuli/workspace/mine/pighand/pighand-AIO/client-applet/pages/ECommerce/pages/distribution-list.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}