{"version":3,"names":["themeDetail","common_vendor","ref","isModalVisible","ticketList","selectedTicketIndex","quantity","totalPrice","computed","value","length","selectedTicket","price","getThemeDetail","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","id","res","wrap","_callee$","_context","prev","next","api_theme","themeAPI","find","sent","t0","index","__f__","stop","_x","apply","arguments","getTicketList","_ref2","_callee2","_callee2$","_context2","api_ticket","ticketAPI","query","name","description","contactService","showToast","title","icon","showTicketModal","hideModal","selectTicket","increaseQuantity","calculatePrice","decreaseQuantity","_ref3","_callee3","_a","_callee3$","_context3","ticketId","purchaseTicket","showModal","content","concat","success","confirm","watch","onLoad","options","wx","createPage","MiniProgramPage"],"sources":["theme.vue","theme.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"content\">\r\n\t\t<!-- 主题海报 -->\r\n\t\t<view class=\"theme-poster\" v-if=\"themeDetail.posterUrl\">\r\n\t\t\t<image :src=\"themeDetail.posterUrl\" mode=\"aspectFill\" class=\"poster-image\"></image>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 主题内容 -->\r\n\t\t<view class=\"theme-content\">\r\n\t\t\t<text class=\"theme-title\" v-if=\"themeDetail.title\">{{ themeDetail.title }}</text>\r\n\t\t\t<text class=\"theme-description\" v-if=\"themeDetail.description\">{{ themeDetail.description }}</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 底部操作栏 -->\r\n\t\t<view class=\"bottom-action-bar\">\r\n\t\t\t<!-- 咨询客服 -->\r\n\t\t\t<view class=\"customer-service\" @click=\"contactService\">\r\n\t\t\t\t<image src=\"/static/icon-customer-service.png\" class=\"service-icon\"></image>\r\n\t\t\t\t<text class=\"service-text\">咨询客服</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 购买按钮 -->\r\n\t\t\t<view class=\"buy-button\" @click=\"showTicketModal\">\r\n\t\t\t\t<text class=\"buy-text\">即刻购票</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 购票弹窗 -->\r\n\t\t<view class=\"ticket-modal\" v-if=\"isModalVisible\" @click=\"hideModal\">\r\n\t\t\t<view class=\"modal-content\" @click.stop>\r\n\t\t\t\t<view class=\"modal-header\">\r\n\t\t\t\t\t<text class=\"modal-title\">购买RAGE</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 票务选择 -->\r\n\t\t\t\t<view class=\"ticket-selection\">\r\n\t\t\t\t\t<view class=\"ticket-item\" \r\n\t\t\t\t\t\t  v-for=\"(ticket, index) in ticketList\" \r\n\t\t\t\t\t\t  :key=\"ticket.id\"\r\n\t\t\t\t\t\t  :class=\"{ 'selected': selectedTicketIndex === index }\"\r\n\t\t\t\t\t\t  @click=\"selectTicket(index)\">\r\n\t\t\t\t\t\t<view class=\"ticket-info\">\r\n\t\t\t\t\t\t\t<text class=\"ticket-name\">{{ ticket.name || 'RAGE' }}</text>\r\n\t\t\t\t\t\t\t<text class=\"ticket-price\">¥ {{ ticket.price || 298 }}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"ticket-desc\">{{ ticket.description || '包含：主题门票一张' }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 购买数量 -->\r\n\t\t\t\t<view class=\"quantity-section\">\r\n\t\t\t\t\t<text class=\"section-title\">购买票数</text>\r\n\t\t\t\t\t<view class=\"quantity-control\">\r\n\t\t\t\t\t\t<view class=\"quantity-btn\" @click=\"decreaseQuantity\">\r\n\t\t\t\t\t\t\t<text class=\"btn-text\">-</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"quantity-text\">{{ quantity }}</text>\r\n\t\t\t\t\t\t<view class=\"quantity-btn\" @click=\"increaseQuantity\">\r\n\t\t\t\t\t\t\t<text class=\"btn-text\">+</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 底部操作 -->\r\n\t\t\t\t<view class=\"modal-footer\">\r\n\t\t\t\t\t<view class=\"total-price\">\r\n\t\t\t\t\t\t<text class=\"price-label\">合计：</text>\r\n\t\t\t\t\t\t<text class=\"price-value\">¥ {{ totalPrice }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"purchase-btn\" @click=\"purchaseTicket\">\r\n\t\t\t\t\t\t<text class=\"purchase-text\">即刻购票</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref, computed, watch } from 'vue'\r\nimport { theme as themeAPI, ticket as ticketAPI } from '@/api'\r\n\r\n// 主题详情数据\r\nconst themeDetail = ref({})\r\n\r\n// 弹窗相关\r\nconst isModalVisible = ref(false)\r\nconst ticketList = ref([])\r\nconst selectedTicketIndex = ref(0)\r\nconst quantity = ref(1)\r\n\r\n// 计算总价\r\nconst totalPrice = computed(() => {\r\n\tif (ticketList.value.length === 0) return 298\r\n\tconst selectedTicket = ticketList.value[selectedTicketIndex.value]\r\n\tconst price = selectedTicket?.price || 298\r\n\treturn price * quantity.value\r\n})\r\n\r\n// 获取主题详情\r\nconst getThemeDetail = async (id) => {\r\n\ttry {\r\n\t\tconst res = await themeAPI.find(id)\r\n\t\tthemeDetail.value = res\r\n\t} catch (error) {\r\n\t\tconsole.error('获取主题详情失败:', error)\r\n\t}\r\n}\r\n\r\n// 获取票务列表\r\nconst getTicketList = async () => {\r\n\ttry {\r\n\t\tconst res = await ticketAPI.query({})\r\n\t\tticketList.value = res || []\r\n\t\t// 如果没有票务数据，使用默认数据\r\n\t\tif (ticketList.value.length === 0) {\r\n\t\t\tticketList.value = [{\r\n\t\t\t\tid: 1,\r\n\t\t\t\tname: 'RAGE',\r\n\t\t\t\tprice: 298,\r\n\t\t\t\tdescription: '包含：主题门票一张'\r\n\t\t\t}]\r\n\t\t}\r\n\t\tselectedTicketIndex.value = 0\r\n\t} catch (error) {\r\n\t\tconsole.error('获取票务列表失败:', error)\r\n\t\t// 使用默认数据\r\n\t\tticketList.value = [{\r\n\t\t\tid: 1,\r\n\t\t\tname: 'RAGE',\r\n\t\t\tprice: 298,\r\n\t\t\tdescription: '包含：主题门票一张'\r\n\t\t}]\r\n\t}\r\n}\r\n\r\n// 咨询客服\r\nconst contactService = () => {\r\n\tuni.showToast({\r\n\t\ttitle: '正在为您转接客服...',\r\n\t\ticon: 'none'\r\n\t})\r\n}\r\n\r\n// 显示购票弹窗\r\nconst showTicketModal = () => {\r\n\tisModalVisible.value = true\r\n\tgetTicketList()\r\n}\r\n\r\n// 隐藏弹窗\r\nconst hideModal = () => {\r\n\tisModalVisible.value = false\r\n\tquantity.value = 1\r\n}\r\n\r\n// 选择票务\r\nconst selectTicket = (index) => {\r\n\tselectedTicketIndex.value = index\r\n}\r\n\r\n// 增加数量\r\nconst increaseQuantity = () => {\r\n\tquantity.value++\r\n\t// 这里可以调用接口计算价格\r\n\tcalculatePrice()\r\n}\r\n\r\n// 减少数量\r\nconst decreaseQuantity = () => {\r\n\tif (quantity.value > 1) {\r\n\t\tquantity.value--\r\n\t\t// 这里可以调用接口计算价格\r\n\t\tcalculatePrice()\r\n\t}\r\n}\r\n\r\n// 计算价格（预留接口调用）\r\nconst calculatePrice = async () => {\r\n\t// TODO: 调用后端接口计算实时价格\r\n\t// const params = {\r\n\t//   ticketId: ticketList.value[selectedTicketIndex.value]?.id,\r\n\t//   quantity: quantity.value\r\n\t// }\r\n\t// const res = await priceAPI.calculate(params)\r\n\tconsole.log('计算价格:', {\r\n\t\tticketId: ticketList.value[selectedTicketIndex.value]?.id,\r\n\t\tquantity: quantity.value,\r\n\t\ttotalPrice: totalPrice.value\r\n\t})\r\n}\r\n\r\n// 购买票务\r\nconst purchaseTicket = () => {\r\n\tconst selectedTicket = ticketList.value[selectedTicketIndex.value]\r\n\tuni.showModal({\r\n\t\ttitle: '确认购买',\r\n\t\tcontent: `确认购买 ${selectedTicket?.name || 'RAGE'} ${quantity.value} 张，总计 ¥${totalPrice.value}？`,\r\n\t\tsuccess: (res) => {\r\n\t\t\tif (res.confirm) {\r\n\t\t\t\t// TODO: 调用购买接口\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '购买成功！',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\thideModal()\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}\r\n\r\n// 监听数量变化\r\nwatch(quantity, () => {\r\n\tcalculatePrice()\r\n})\r\n\r\nonLoad((options) => {\r\n\tconsole.log(options)\r\n\tconst { id } = options\r\n\tif (id) {\r\n\t\tgetThemeDetail(id)\r\n\t}\r\n})\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.content {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n}\r\n\r\n.theme-poster {\r\n\twidth: 100%;\r\n\theight: 400rpx;\r\n\tposition: relative;\r\n\toverflow: hidden;\r\n}\r\n\r\n.poster-image {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tobject-fit: cover;\r\n}\r\n\r\n.theme-content {\r\n\tpadding: 30rpx;\r\n\tbackground-color: #fff;\r\n\tmargin-top: 20rpx;\r\n}\r\n\r\n.theme-title {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tdisplay: block;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.theme-description {\r\n\tfont-size: 28rpx;\r\n\tcolor: #666;\r\n\tline-height: 1.6;\r\n\tdisplay: block;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/wangshuli/workspace/mine/pighand/pighand-AIO/client-applet/pages/ECommerce/pages/theme.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}