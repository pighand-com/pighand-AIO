{"version":3,"file":"login.js","sources":["common/login.ts"],"sourcesContent":["import { getToken, setToken, setUserInfo, setApplicationInfo } from '@/common/storage';\nimport api from '@/api/login';\n\n/**\n * 登录\n * @param options 登录选项\n * @param options.silent 是否静默登录\n */\nexport default async (options: { silent?: false } = {}) => {\n    const token = getToken();\n\n    if (token) {\n        return;\n    }\n\n    uni.showLoading({\n        title: '登录中...'\n    });\n\n    try {\n        const loginRes: any = await new Promise((resolve, reject) => {\n            uni.login({\n                success: (res) => resolve(res),\n                fail: (err) => reject(err)\n            });\n        });\n        \n        const { code } = loginRes;\n        const res = await api.login(code);\n        \n        if (!res) {\n            return;\n        }\n        \n        const { token, application, ...userInfo } = res;\n        setToken(token);\n        setUserInfo(userInfo);\n\t\tsetApplicationInfo(application)\n\n        if (!options.silent) {\n            uni.showToast({\n                title: '登录成功',\n                icon: 'success'\n            });\n        }\n    } catch (error) {\n        if (!options.silent) {\n            uni.showToast({\n                title: '登录失败',\n                icon: 'error'\n            });\n        }\n    }\n}\n"],"names":["getToken","uni","res","api","token","setToken","setUserInfo","setApplicationInfo"],"mappings":";;;;AAQA,MAAA,QAAe,OAAO,UAA8B,CAAA,MAAO;AACvD,QAAM,QAAQA,eAAAA;AAEd,MAAI,OAAO;AACP;AAAA,EACJ;AAEAC,gBAAAA,MAAI,YAAY;AAAA,IACZ,OAAO;AAAA,EAAA,CACV;AAEG,MAAA;AACA,UAAM,WAAgB,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACzDA,oBAAAA,MAAI,MAAM;AAAA,QACN,SAAS,CAACC,SAAQ,QAAQA,IAAG;AAAA,QAC7B,MAAM,CAAC,QAAQ,OAAO,GAAG;AAAA,MAAA,CAC5B;AAAA,IAAA,CACJ;AAEK,UAAA,EAAE,KAAS,IAAA;AACjB,UAAM,MAAM,MAAMC,UAAAA,IAAI,MAAM,IAAI;AAEhC,QAAI,CAAC,KAAK;AACN;AAAA,IACJ;AAEA,UAAM,EAAE,OAAAC,QAAO,aAAa,GAAG,SAAa,IAAA;AAC5CC,mBAAA,SAASD,MAAK;AACdE,mBAAA,YAAY,QAAQ;AAC1BC,mBAAA,mBAAmB,WAAW;AAEpB,QAAA,CAAC,QAAQ,QAAQ;AACjBN,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MAAA,CACT;AAAA,IACL;AAAA,WACK,OAAO;AACR,QAAA,CAAC,QAAQ,QAAQ;AACjBA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MAAA,CACT;AAAA,IACL;AAAA,EACJ;AACJ;;"}