{"version":3,"file":"request.js","sources":["common/request.ts"],"sourcesContent":["import constant from './constant';\nimport { getToken, clearAll } from './storage';\n\ninterface RequestConfig {\n    isDialog?: boolean;\n    headers?: any;\n    params?: any;\n    responseType?: string;\n\tonUploadProgress?: any;\n}\n\nconst getUrl = (url: string) => {\n    return constant.api[__wxConfig.envVersion] + url;\n};\n\nconst disposeResponse = (response: any, isDialog = true, blob = false) => {\n    const { statusCode, data } = response;\n\n    let errorMsg = '';\n    let isSuccess = true;\n\n    if (statusCode === 200 && data.code && data.code !== 200) {\n        isSuccess = false;\n        errorMsg = data.msg || data.error;\n    } else if (statusCode === 401) {\n        clearAll();\n        uni.showToast({\n            title: \"请先登录\",\n            icon: 'error'\n        });\n        return;\n    } else if (statusCode !== 200) {\n        isSuccess = false;\n        errorMsg = data;\n    }\n\n    let result: { data: object; error: string } | any = {\n        data: data.data,\n        error: errorMsg\n    };\n\n    if (isDialog) {\n        if (!isSuccess) {\n            uni.showToast({\n                title: errorMsg,\n                icon: 'error'\n            });\n            throw new Error(errorMsg);\n        }\n        result = data.data;\n    }\n\n    // blob 下载逻辑在小程序环境可能需要使用其他方式实现\n    return result;\n};\n\nconst request = async (method: 'GET' | 'POST' | 'PUT' | 'DELETE', url: string, data?: any, config?: RequestConfig) => {\n    url = getUrl(url);\n    \n    const requestConfig: any = {\n        url,\n        method,\n        data,\n        header: {\n            'X-Application-Id': constant.APPLICATION_ID,\n            ...(config?.headers || {}),\n            'Authorization': getToken()\n        },\n        timeout: 60000\n    };\n\n    try {\n        const response = await uni.request(requestConfig);\n\t\t\n        return disposeResponse(response, config?.isDialog, config?.responseType === 'blob');\n    } catch (error) {\n        uni.showToast({\n            title: '网络请求失败：' + error,\n            icon: 'none'\n        });\n        throw error;\n    }\n};\n\nconst get = (url: string, params?: any, config?: RequestConfig) => {\n    return request('GET', url, params, config);\n};\n\nconst post = (url: string, data?: any, config?: RequestConfig) => {\n    return request('POST', url, data, config);\n};\n\nconst put = (url: string, data?: any, config?: RequestConfig) => {\n    return request('PUT', url, data, config);\n};\n\nconst del = (url: string, params?: any, config?: RequestConfig) => {\n    return request('DELETE', url, params, config);\n};\n\nexport default {\n    get,\n    post,\n    put,\n    del\n};\n"],"names":["constant","clearAll","uni","getToken"],"mappings":";;;;AAWA,MAAM,SAAS,CAAC,QAAgB;AAC5B,SAAOA,gBAAS,SAAA,IAAI,WAAW,UAAU,IAAI;AACjD;AAEA,MAAM,kBAAkB,CAAC,UAAe,WAAW,MAAM,OAAO,UAAU;AAChE,QAAA,EAAE,YAAY,KAAS,IAAA;AAE7B,MAAI,WAAW;AACf,MAAI,YAAY;AAEhB,MAAI,eAAe,OAAO,KAAK,QAAQ,KAAK,SAAS,KAAK;AAC1C,gBAAA;AACD,eAAA,KAAK,OAAO,KAAK;AAAA,EAAA,WACrB,eAAe,KAAK;AAClBC,mBAAAA;AACTC,kBAAAA,MAAI,UAAU;AAAA,MACV,OAAO;AAAA,MACP,MAAM;AAAA,IAAA,CACT;AACD;AAAA,EAAA,WACO,eAAe,KAAK;AACf,gBAAA;AACD,eAAA;AAAA,EACf;AAEA,MAAI,SAAgD;AAAA,IAChD,MAAM,KAAK;AAAA,IACX,OAAO;AAAA,EAAA;AAGX,MAAI,UAAU;AACV,QAAI,CAAC,WAAW;AACZA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MAAA,CACT;AACK,YAAA,IAAI,MAAM,QAAQ;AAAA,IAC5B;AACA,aAAS,KAAK;AAAA,EAClB;AAGO,SAAA;AACX;AAEA,MAAM,UAAU,OAAO,QAA2C,KAAa,MAAY,WAA2B;AAClH,QAAM,OAAO,GAAG;AAEhB,QAAM,gBAAqB;AAAA,IACvB;AAAA,IACA;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,MACJ,oBAAoBF,gBAAS,SAAA;AAAA,MAC7B,IAAI,iCAAQ,YAAW,CAAC;AAAA,MACxB,iBAAiBG,eAAAA,SAAS;AAAA,IAC9B;AAAA,IACA,SAAS;AAAA,EAAA;AAGT,MAAA;AACA,UAAM,WAAW,MAAMD,cAAAA,MAAI,QAAQ,aAAa;AAEhD,WAAO,gBAAgB,UAAU,iCAAQ,WAAU,iCAAQ,kBAAiB,MAAM;AAAA,WAC7E,OAAO;AACZA,kBAAAA,MAAI,UAAU;AAAA,MACV,OAAO,YAAY;AAAA,MACnB,MAAM;AAAA,IAAA,CACT;AACK,UAAA;AAAA,EACV;AACJ;AAEA,MAAM,MAAM,CAAC,KAAa,QAAc,WAA2B;AAC/D,SAAO,QAAQ,OAAO,KAAK,QAAQ,MAAM;AAC7C;AAEA,MAAM,OAAO,CAAC,KAAa,MAAY,WAA2B;AAC9D,SAAO,QAAQ,QAAQ,KAAK,MAAM,MAAM;AAC5C;AAEA,MAAM,MAAM,CAAC,KAAa,MAAY,WAA2B;AAC7D,SAAO,QAAQ,OAAO,KAAK,MAAM,MAAM;AAC3C;AAEA,MAAM,MAAM,CAAC,KAAa,QAAc,WAA2B;AAC/D,SAAO,QAAQ,UAAU,KAAK,QAAQ,MAAM;AAChD;AAEA,MAAe,YAAA;AAAA,EACX;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ;;"}