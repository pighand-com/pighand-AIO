{"version":3,"file":"phone.js","sources":["components/user/phone.vue","/Users/wangshuli/workspace/mine/pighand/pighand-AIO/client-applet/components/user/phone.vue?type=component"],"sourcesContent":["<template>\r\n\t<view class=\"phone-wrapper\">\r\n\t\t<slot></slot>\r\n\t\t<button v-if=\"!phoneRef\"\r\n\t\t\tclass=\"overlay-button\" \r\n\t\t\topen-type=\"getPhoneNumber\" \r\n\t\t\t@getphonenumber=\"finishGetPhoneNumber\"\r\n\t\t></button>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onUnmounted } from 'vue'\r\nimport { user } from '@/api'\r\nimport {getUserInfo, setUserInfo} from '@/common/storage'\r\n\r\nconst phoneRef = ref(getUserInfo().phone);\r\n\r\n// 监听storage变化\r\nconst handleStorageChange = () => {\r\n    phoneRef.value = getUserInfo().phone;\r\n}\r\n\r\nuni.$on('storage-changed', handleStorageChange)\r\n\r\n// 组件卸载时移除事件监听\r\nonUnmounted(() => {\r\n    uni.$off('storage-changed', handleStorageChange)\r\n})\r\n\r\n\t\t\t\r\nconst finishGetPhoneNumber = async(params) => {\r\n\tuni.showLoading({\r\n\t\ttitle: '绑定手机号中...'\r\n\t});\r\n\tconst { detail: { errMsg, code, } } = params;\r\n\r\n\tif (errMsg === 'getPhoneNumber:fail user deny') {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst userInfo = await user.bindPhoneWechat(code);\r\n\t\r\n\tsetUserInfo({\r\n\t\t...getUserInfo(),\r\n\t\tphone: userInfo.phone\r\n\t});\r\n\tuni.hideLoading();\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.phone-wrapper {\r\n\tposition: relative;\r\n}\r\n\r\n.overlay-button {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\topacity: 0;\r\n\tz-index: 1;\r\n}\r\n</style>\r\n","import Component from '/Users/wangshuli/workspace/mine/pighand/pighand-AIO/client-applet/components/user/phone.vue'\nwx.createComponent(Component)"],"names":["ref","getUserInfo","uni","onUnmounted","user","setUserInfo"],"mappings":";;;;;;;AAgBA,UAAM,WAAWA,cAAG,IAACC,2BAAa,EAAC,KAAK;AAGxC,UAAM,sBAAsB,MAAM;AAC9B,eAAS,QAAQA,2BAAa,EAAC;AAAA,IACnC;AAEAC,kBAAAA,MAAI,IAAI,mBAAmB,mBAAmB;AAG9CC,kBAAAA,YAAY,MAAM;AACdD,0BAAI,KAAK,mBAAmB,mBAAmB;AAAA,IACnD,CAAC;AAGD,UAAM,uBAAuB,OAAM,WAAW;AAC7CA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,MACT,CAAE;AACD,YAAM,EAAE,QAAQ,EAAE,QAAQ,KAAO,EAAA,IAAK;AAEtC,UAAI,WAAW,iCAAiC;AAC/C;AAAA,MACA;AAED,YAAM,WAAW,MAAME,SAAAA,KAAK,gBAAgB,IAAI;AAEhDC,iCAAY;AAAA,QACX,GAAGJ,2BAAa;AAAA,QAChB,OAAO,SAAS;AAAA,MAClB,CAAE;AACDC,oBAAG,MAAC,YAAW;AAAA,IAChB;;;;;;;;;;;AC/CA,GAAG,gBAAgB,SAAS;"}