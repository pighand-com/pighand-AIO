{"version":3,"file":"order-list.js","sources":["pages/ECommerce/pages/order-list.vue","pages/ECommerce/pages/order-list.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"page-container\">\r\n    \r\n    <!-- 优化后的标签栏 -->\r\n    <view class=\"tabs-container\">\r\n      <custom-navigation-bar :back=\"true\" position=\"flex\" title=\"我的订单\" />\r\n      <view class=\"tabs\">\r\n        <view\r\n          v-for=\"(tab, idx) in tabs\"\r\n          :key=\"tab.tradeStatus\"\r\n          :class=\"['tab', { active: idx === activeTab }]\"\r\n          @tap=\"changeTab(idx)\"\r\n        >\r\n          <text class=\"tab-text\">{{ tab.label }}</text>\r\n          <view v-if=\"idx === activeTab\" class=\"tab-indicator\"></view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 优化后的订单列表 -->\r\n    <view class=\"order-list\">\r\n      <view v-for=\"order in orderList\" :key=\"order.sn\" class=\"order-item\" @tap=\"goToOrderDetail(order.id)\">\r\n        <!-- 订单头部信息 -->\r\n        <view class=\"order-header\">\r\n          <view class=\"order-info\">\r\n            <text class=\"order-label\">订单编号</text>\r\n            <text class=\"order-sn\" @longpress=\"copyOrderSn(order.sn)\">{{ order.sn }}</text>\r\n          </view>\r\n          <text class=\"order-date\">{{ formatDate(order.createdAt) }}</text>\r\n        </view>\r\n        \r\n        <!-- 商品信息 -->\r\n        <view class=\"order-goods\">\r\n\t\t\t\r\n\t\t<view v-for=\"(ticket, index) in order.ticket\" :key=\"ticket.id + '_' + index\" class=\"goods-item\">\r\n            <view class=\"goods-img-container\">\r\n              <image \r\n                v-if=\"ticket?.theme?.posterUrl\" \r\n                :src=\"ticket?.theme?.posterUrl\" \r\n                class=\"goods-img\" \r\n                mode=\"aspectFill\" \r\n              />\r\n              <view v-else class=\"goods-img-placeholder\">\r\n                <text class=\"placeholder-text\">暂无图片</text>\r\n              </view>\r\n            </view>\r\n            <view class=\"goods-info\">\r\n              <view class=\"goods-main\">\r\n                <text class=\"goods-name\">{{ ticket?.name || '未知商品' }}</text>\r\n                <view class=\"goods-meta\">\r\n                  <text class=\"goods-qty\">数量：{{ getTicketQuantityFromMap(order, ticket.id) }}</text>\r\n                </view>\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        \r\n        <!-- 订单底部 -->\r\n        <view class=\"order-footer\">\r\n          <view class=\"order-actions\">\r\n            <!-- 可以在这里添加操作按钮 -->\r\n          </view>\r\n          <view class=\"order-amount-container\">\r\n            <!-- 根据订单状态显示不同的金额信息 -->\r\n            <template v-if=\"tabs[activeTab].tradeStatus === 51\">\r\n              <text class=\"amount-label\">退款金额</text>\r\n              <text class=\"order-amount refund-amount\">￥{{ formatAmount(order.refundAmount) }}</text>\r\n            </template>\r\n            <template v-else>\r\n              <text class=\"amount-label\">实付金额</text>\r\n              <text class=\"order-amount paid-amount\">￥{{ formatAmount(order.amountPaid) }}</text>\r\n            </template>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- 空状态优化 -->\r\n      <view v-if=\"orderList.length === 0\" class=\"empty-state\">\r\n        <text class=\"empty-text\">暂无订单</text>\r\n        <text class=\"empty-desc\">您还没有相关订单哦</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref } from 'vue'\r\nimport { order as orderAPI } from '@/api'\r\nimport Decimal from 'decimal.js'\r\n\r\nconst tabs = [\r\n  { label: '待付款', tradeStatus: 10 },\r\n  { label: '已付款', tradeStatus: 40 },\r\n  { label: '退款/售后', tradeStatus: 51 }\r\n]\r\nconst activeTab = ref(0)\r\nconst orderList = ref([])\r\n\r\n// 格式化时间戳为日期\r\nfunction formatDate(timestamp) {\r\n  if (!timestamp) return ''\r\n  const date = new Date(timestamp)\r\n  const year = date.getFullYear()\r\n  const month = String(date.getMonth() + 1).padStart(2, '0')\r\n  const day = String(date.getDate()).padStart(2, '0')\r\n  const hours = String(date.getHours()).padStart(2, '0')\r\n  const minutes = String(date.getMinutes()).padStart(2, '0')\r\n  return `${year}.${month}.${day} ${hours}:${minutes}`\r\n}\r\n\r\n// 获取票券数量\r\nfunction getTicketQuantityFromMap(order, ticketId) {\r\n  // 创建ticketId到quantity的映射\r\n  if (!order._ticketQuantityMap) {\r\n    order._ticketQuantityMap = new Map()\r\n    order.orderSku?.forEach(sku => {\r\n      if (sku.ticketId) {\r\n        order._ticketQuantityMap.set(sku.ticketId, sku.quantity || 0)\r\n      }\r\n    })\r\n  }\r\n  return order._ticketQuantityMap.get(ticketId) || 0\r\n}\r\n\r\n// 获取订单列表\r\nfunction fetchOrders() {\r\n  const tradeStatus = tabs[activeTab.value].tradeStatus\r\n  orderAPI.query({ tradeStatus }).then(res => {\r\n    orderList.value = res?.records || []\r\n  })\r\n}\r\n\r\n// 切换tab并刷新订单列表\r\nfunction changeTab(idx) {\r\n  activeTab.value = idx\r\n  fetchOrders()\r\n}\r\n\r\n// 复制订单编号\r\nfunction copyOrderSn(orderSn) {\r\n  uni.setClipboardData({\r\n    data: orderSn,\r\n    success: () => {\r\n      uni.showToast({\r\n        title: '订单编号已复制',\r\n        icon: 'success',\r\n        duration: 2000\r\n      })\r\n    },\r\n    fail: () => {\r\n      uni.showToast({\r\n        title: '复制失败',\r\n        icon: 'none',\r\n        duration: 2000\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// 跳转到订单详情页\r\nfunction goToOrderDetail(id) {\r\n  uni.navigateTo({\r\n    url: `/pages/ECommerce/pages/order-detail?id=${id}`\r\n  })\r\n}\r\n\r\n// 将分转换为元\r\nfunction formatAmount(amountInCents) {\r\n  if (!amountInCents && amountInCents !== 0) return '0.00'\r\n  return new Decimal(amountInCents).div(100).toFixed(2)\r\n}\r\n\r\n// 页面加载时处理跳转参数并拉取订单\r\nonLoad((options) => {\r\n  if (options && options.tradeStatus) {\r\n    const idx = tabs.findIndex(tab => String(tab.tradeStatus) === String(options.tradeStatus))\r\n    if (idx !== -1) {\r\n      activeTab.value = idx\r\n    }\r\n  }\r\n  fetchOrders()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n/* 页面容器 */\r\n.page-container {\r\n  min-height: 100vh;\r\n  background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);\r\n}\r\n\r\n/* 标签栏容器 */\r\n.tabs-container {\r\n  background: #ffffff;\r\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.tabs {\r\n  display: flex;\r\n  padding: 0 32rpx;\r\n}\r\n\r\n.tab {\r\n  flex: 1;\r\n  position: relative;\r\n  padding: 32rpx 0;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.tab-text {\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n  color: #8a8a8a;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.tab.active .tab-text {\r\n  color: #007aff;\r\n  font-weight: 600;\r\n  transform: scale(1.05);\r\n}\r\n\r\n.tab-indicator {\r\n  position: absolute;\r\n  bottom: 0;\r\n  width: 60rpx;\r\n  height: 6rpx;\r\n  background: linear-gradient(90deg, #007aff 0%, #5ac8fa 100%);\r\n  border-radius: 3rpx;\r\n  animation: slideIn 0.3s ease;\r\n}\r\n\r\n@keyframes slideIn {\r\n  from {\r\n    width: 0;\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    width: 60rpx;\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* 订单列表 */\r\n.order-list {\r\n  padding: 32rpx 24rpx;\r\n  padding-top: 32rpx;\r\n}\r\n\r\n.order-item {\r\n  position: relative;\r\n  background: #ffffff;\r\n  margin-bottom: 32rpx;\r\n  border-radius: 24rpx;\r\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.06);\r\n  padding: 32rpx;\r\n  border: 1rpx solid #f0f0f0;\r\n  transition: all 0.3s ease;\r\n  overflow: hidden;\r\n}\r\n\r\n.order-item:hover {\r\n  transform: translateY(-4rpx);\r\n  box-shadow: 0 12rpx 40rpx rgba(0, 0, 0, 0.12);\r\n}\r\n\r\n\r\n\r\n/* 订单头部 */\r\n.order-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  margin-bottom: 24rpx;\r\n  padding-top: 16rpx;\r\n}\r\n\r\n.order-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8rpx;\r\n}\r\n\r\n.order-label {\r\n  font-size: 24rpx;\r\n  color: #8a8a8a;\r\n  font-weight: 400;\r\n}\r\n\r\n.order-sn {\r\n  font-size: 28rpx;\r\n  color: #007aff;\r\n  font-weight: 500;\r\n  font-family: 'SF Mono', Monaco, monospace;\r\n  cursor: pointer;\r\n}\r\n\r\n.order-date {\r\n  font-size: 26rpx;\r\n  color: #8a8a8a;\r\n  font-weight: 400;\r\n}\r\n\r\n/* 商品信息 */\r\n.order-goods {\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.goods-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 20rpx 0;\r\n  border-bottom: 1rpx solid #f5f5f7;\r\n  height: 140rpx;\r\n}\r\n\r\n.goods-item:last-child {\r\n  border-bottom: none;\r\n  padding-bottom: 0;\r\n}\r\n\r\n.goods-img-container {\r\n  margin-right: 24rpx;\r\n  width: 140rpx;\r\n  height: 140rpx;\r\n}\r\n\r\n.goods-img {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 16rpx;\r\n  background: #f5f5f7;\r\n  border: 1rpx solid #e5e5ea;\r\n}\r\n\r\n.goods-img-placeholder {\r\n  border-radius: 16rpx;\r\n  background: linear-gradient(135deg, #f5f5f7 0%, #e5e5ea 100%);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border: 1rpx dashed #d1d1d6;\r\n}\r\n\r\n.placeholder-text {\r\n  font-size: 22rpx;\r\n  color: #8a8a8a;\r\n}\r\n\r\n.goods-info {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 140rpx;\r\n}\r\n\r\n.goods-main {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-around;\r\n  height: 100%;\r\n}\r\n\r\n.goods-name {\r\n  font-size: 30rpx;\r\n  color: #1d1d1f;\r\n  font-weight: 500;\r\n  line-height: 1.4;\r\n  max-width: 400rpx;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.goods-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n}\r\n\r\n.goods-qty {\r\n  font-size: 26rpx;\r\n  color: #8a8a8a;\r\n  background: #f5f5f7;\r\n  padding: 6rpx 12rpx;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n/* 订单底部 */\r\n.order-footer {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding-top: 24rpx;\r\n  border-top: 1rpx solid #f5f5f7;\r\n}\r\n\r\n.order-actions {\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n\r\n.order-amount-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-end;\r\n  gap: 4rpx;\r\n}\r\n\r\n.amount-label {\r\n  font-size: 24rpx;\r\n  color: #8a8a8a;\r\n}\r\n\r\n.order-amount {\r\n  font-size: 36rpx;\r\n  font-weight: 600;\r\n  font-family: 'SF Pro Display', -apple-system, sans-serif;\r\n}\r\n\r\n/* 金额颜色统一规范 */\r\n.refund-amount {\r\n  color: #34c759 !important; /* 退款金额：绿色 */\r\n}\r\n\r\n.paid-amount {\r\n  color: #ff3b30 !important; /* 实付金额：红色 */\r\n}\r\n\r\n/* 空状态 */\r\n.empty-state {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 120rpx 40rpx;\r\n  text-align: center;\r\n}\r\n\r\n.empty-text {\r\n  font-size: 32rpx;\r\n  color: #1d1d1f;\r\n  font-weight: 500;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.empty-desc {\r\n  font-size: 28rpx;\r\n  color: #8a8a8a;\r\n  line-height: 1.5;\r\n}\r\n\r\n</style>\r\n","import MiniProgramPage from '/Users/wangshuli/workspace/mine/pighand/pighand-AIO/client-applet/pages/ECommerce/pages/order-list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","orderAPI","uni","Decimal","onLoad"],"mappings":";;;;;;;;;;;;;;AA2FA,UAAM,OAAO;AAAA,MACX,EAAE,OAAO,OAAO,aAAa,GAAI;AAAA,MACjC,EAAE,OAAO,OAAO,aAAa,GAAI;AAAA,MACjC,EAAE,OAAO,SAAS,aAAa,GAAI;AAAA,IACrC;AACA,UAAM,YAAYA,cAAG,IAAC,CAAC;AACvB,UAAM,YAAYA,cAAG,IAAC,EAAE;AAGxB,aAAS,WAAW,WAAW;AAC7B,UAAI,CAAC;AAAW,eAAO;AACvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,YAAM,OAAO,KAAK,YAAa;AAC/B,YAAM,QAAQ,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG;AACzD,YAAM,MAAM,OAAO,KAAK,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAClD,YAAM,QAAQ,OAAO,KAAK,SAAU,CAAA,EAAE,SAAS,GAAG,GAAG;AACrD,YAAM,UAAU,OAAO,KAAK,WAAY,CAAA,EAAE,SAAS,GAAG,GAAG;AACzD,aAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK,IAAI,OAAO;AAAA,IACpD;AAGA,aAAS,yBAAyB,OAAO,UAAU;;AAEjD,UAAI,CAAC,MAAM,oBAAoB;AAC7B,cAAM,qBAAqB,oBAAI,IAAK;AACpC,oBAAM,aAAN,mBAAgB,QAAQ,SAAO;AAC7B,cAAI,IAAI,UAAU;AAChB,kBAAM,mBAAmB,IAAI,IAAI,UAAU,IAAI,YAAY,CAAC;AAAA,UAC7D;AAAA,QACP;AAAA,MACG;AACD,aAAO,MAAM,mBAAmB,IAAI,QAAQ,KAAK;AAAA,IACnD;AAGA,aAAS,cAAc;AACrB,YAAM,cAAc,KAAK,UAAU,KAAK,EAAE;AAC1CC,gBAAQ,SAAC,MAAM,EAAE,YAAa,CAAA,EAAE,KAAK,SAAO;AAC1C,kBAAU,SAAQ,2BAAK,YAAW,CAAE;AAAA,MACxC,CAAG;AAAA,IACH;AAGA,aAAS,UAAU,KAAK;AACtB,gBAAU,QAAQ;AAClB,kBAAa;AAAA,IACf;AAGA,aAAS,YAAY,SAAS;AAC5BC,oBAAAA,MAAI,iBAAiB;AAAA,QACnB,MAAM;AAAA,QACN,SAAS,MAAM;AACbA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAClB,CAAO;AAAA,QACF;AAAA,QACD,MAAM,MAAM;AACVA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAClB,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,aAAS,gBAAgB,IAAI;AAC3BA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,0CAA0C,EAAE;AAAA,MACrD,CAAG;AAAA,IACH;AAGA,aAAS,aAAa,eAAe;AACnC,UAAI,CAAC,iBAAiB,kBAAkB;AAAG,eAAO;AAClD,aAAO,IAAIC,cAAO,QAAC,aAAa,EAAE,IAAI,GAAG,EAAE,QAAQ,CAAC;AAAA,IACtD;AAGAC,kBAAM,OAAC,CAAC,YAAY;AAClB,UAAI,WAAW,QAAQ,aAAa;AAClC,cAAM,MAAM,KAAK,UAAU,SAAO,OAAO,IAAI,WAAW,MAAM,OAAO,QAAQ,WAAW,CAAC;AACzF,YAAI,QAAQ,IAAI;AACd,oBAAU,QAAQ;AAAA,QACnB;AAAA,MACF;AACD,kBAAa;AAAA,IACf,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrLD,GAAG,WAAW,eAAe;"}