{"version":3,"file":"theme.js","sources":["pages/ECommerce/pages/theme.vue","pages/ECommerce/pages/theme.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"content\">\r\n\t\t<custom-navigation-bar :back=\"true\" />\r\n\t\t\r\n\t\t<!-- 主题海报 -->\r\n\t\t<view class=\"theme-poster\" v-if=\"themeDetail.posterUrl\">\r\n\t\t\t<image :src=\"themeDetail.posterUrl\" class=\"poster-image\" mode=\"widthFix\"></image>\r\n\t\t\t<!-- 状态栏渐变遮罩 -->\r\n\t\t\t<status-bar-gradient />\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 主题内容 -->\r\n\t\t<view class=\"theme-content\">\r\n\t\t\t<text class=\"theme-title\" v-if=\"themeDetail.title\">{{ themeDetail.title }}</text>\r\n\t\t\t<rich-text class=\"theme-description\" v-if=\"themeDetail.pictureDescription\" :nodes=\"themeDetail.pictureDescription\"></rich-text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 底部操作栏 -->\r\n\t\t<view class=\"bottom-action-bar\">\r\n\t\t\t<!-- 咨询客服 - 只有当serviceQrUrl有值时才显示 -->\r\n\t\t\t<view class=\"customer-service\" @click=\"contactService\" v-if=\"themeDetail.serviceQrUrl\">\r\n\t\t\t\t<image src=\"/static/icon-customer-service.png\" class=\"service-icon\"></image>\r\n\t\t\t\t<text class=\"service-text\">咨询客服</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 购买按钮 -->\r\n\t\t\t<user-check :item=\"['login', 'phone']\">\r\n\t\t\t\t<view class=\"buy-button\" @click=\"showTicketModal\">\r\n\t\t\t\t\t<text class=\"buy-text\">即刻购票</text>\r\n\t\t\t\t</view>\r\n\t\t\t</user-check>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 购票弹窗 -->\r\n\t\t<view class=\"ticket-modal\" v-if=\"isModalVisible\" @click=\"hideModal\">\r\n\t\t\t<view class=\"modal-content\" @click.stop>\r\n\t\t\t\t<!-- 票务选择 -->\r\n\t\t\t\t<view class=\"ticket-selection-container\">\r\n\t\t\t\t\t<view class=\"ticket-selection\" @scroll=\"onTicketScroll\" :scroll-y=\"true\">\r\n\t\t\t\t\t\t<view class=\"ticket-item\" \r\n\t\t\t\t\t\t\t  v-for=\"(ticket, index) in ticketList\" \r\n\t\t\t\t\t\t\t  :key=\"ticket.id\"\r\n\t\t\t\t\t\t\t  :class=\"{ 'selected': selectedTicketIndex === index }\"\r\n\t\t\t\t\t\t\t  @click=\"selectTicket(index)\">\r\n\t\t\t\t\t\t\t<view class=\"ticket-info\">\r\n\t\t\t\t\t\t\t\t<text class=\"ticket-name\">{{ ticket.name }}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"ticket-price\">¥ {{ ticket.currentPrice ? new Decimal(ticket.currentPrice).div(100).toNumber() : 0 }}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"ticket-desc-container\">\r\n\t\t\t\t\t\t\t\t<text class=\"ticket-desc\" :class=\"{ 'expanded': expandedTickets[index] }\">\r\n\t\t\t\t\t\t\t\t\t{{ getDisplayText(ticket.details, index) }}\r\n\t\t\t\t\t\t\t\t</text>\r\n\t\t\t\t\t\t\t\t<text class=\"expand-btn\" \r\n\t\t\t\t\t\t\t\t\t  v-if=\"isTextTruncated(ticket.details)\"\r\n\t\t\t\t\t\t\t\t\t  @click.stop=\"toggleExpand(index)\">\r\n\t\t\t\t\t\t\t\t\t{{ expandedTickets[index] ? '收起' : '展开' }}\r\n\t\t\t\t\t\t\t\t</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 滚动提示 -->\r\n\t\t\t\t\t<view class=\"scroll-indicator\" v-if=\"showScrollIndicator\">\r\n\t\t\t\t\t\t<text class=\"scroll-text\">向下滑动查看更多票种</text>\r\n\t\t\t\t\t\t<view class=\"scroll-arrow\">↓</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 底部渐变遮罩 -->\r\n\t\t\t\t\t<view class=\"scroll-gradient\" v-if=\"canScrollDown\"></view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 购买数量 -->\r\n\t\t\t\t<view class=\"quantity-section\">\r\n\t\t\t\t\t<text class=\"section-title\">购买票数</text>\r\n\t\t\t\t\t<view class=\"quantity-control\">\r\n\t\t\t\t\t\t<view class=\"quantity-btn\" @click=\"decreaseQuantity\">\r\n\t\t\t\t\t\t\t<text class=\"btn-text\">-</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"quantity-text\">{{ quantity }}</text>\r\n\t\t\t\t\t\t<view class=\"quantity-btn\" @click=\"increaseQuantity\">\r\n\t\t\t\t\t\t\t<text class=\"btn-text\">+</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 底部操作 -->\r\n\t\t\t\t<view class=\"modal-footer\">\r\n\t\t\t\t\t<view class=\"total-price\">\r\n\t\t\t\t\t\t<text class=\"price-label\">合计：</text>\r\n\t\t\t\t\t\t<text class=\"price-value\">¥ {{ totalPrice }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"purchase-btn\" :class=\"{ 'loading': isPurchasing }\" @click=\"purchaseTicket\">\r\n\t\t\t\t\t\t<text class=\"purchase-text\" v-if=\"!isPurchasing\">即刻购票</text>\r\n\t\t\t\t\t\t<text class=\"purchase-text\" v-else>购票中...</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 客服二维码弹窗 -->\r\n\t\t<view class=\"qr-modal\" v-if=\"isQrModalVisible\" @click=\"hideQrModal\">\r\n\t\t\t<view class=\"qr-modal-content\" @click.stop>\r\n\t\t\t\t<view class=\"qr-image-container\">\r\n\t\t\t\t\t<image :src=\"themeDetail.serviceQrUrl\" mode=\"aspectFit\" class=\"qr-image\" show-menu-by-longpress></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"qr-tip\">长按保存二维码，微信扫码联系客服</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 全屏loading遮罩 -->\r\n\t\t<view class=\"loading-overlay\" v-if=\"isLoading\">\r\n\t\t\t<view class=\"loading-content\">\r\n\t\t\t\t<view class=\"loading-spinner\"></view>\r\n\t\t\t\t<text class=\"loading-text\">购买中...</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { ref, computed, watch } from 'vue'\r\nimport Decimal from 'decimal.js';\r\nimport { theme as themeAPI, ticket as ticketAPI, order as orderAPI } from '@/api'\r\nimport { getFromSalesId } from '@/common/storage'\r\n\r\n// 主题详情数据\r\nconst themeDetail = ref({})\r\n\r\n// 弹窗相关\r\nconst isModalVisible = ref(false)\r\nconst isQrModalVisible = ref(false) // 新增：二维码弹窗显示状态\r\nconst ticketList = ref([])\r\nconst selectedTicketIndex = ref(0)\r\nconst quantity = ref(1)\r\nconst totalPrice = ref(0)\r\nconst isPurchasing = ref(false) // 购票loading状态\r\nconst isLoading = ref(false) // 全屏loading状态\r\nconst showScrollIndicator = ref(false) // 滚动提示显示状态\r\nconst canScrollDown = ref(false) // 是否可以向下滚动\r\nconst expandedTickets = ref({}) // 票务详情展开状态\r\nconst MAX_DESC_LENGTH = 50 // 描述文本最大显示长度\r\n\r\n// 监听数量变化\r\nwatch([quantity, selectedTicketIndex], () => {\r\n\t// 当数量或选择的票种变化时，重新计算价格\r\n\tcalculatePrice()\r\n})\r\n\r\nonLoad((options) => {\r\n\tconst { id } = options\r\n\tif (id) {\r\n\t\tgetThemeDetail(id)\r\n\t}\r\n})\r\n\r\n// 获取主题详情\r\nconst getThemeDetail = async (id) => {\r\n\ttry {\r\n\t\tconst res = await themeAPI.find(id)\r\n\t\tthemeDetail.value = res\r\n\t} catch (error) {\r\n\t\tconsole.error('获取主题详情失败:', error)\r\n\t}\r\n}\r\n\r\n// 获取票务列表\r\nconst getTicketList = async () => {\r\n\tconst res = await ticketAPI.query({ themeId: themeDetail.value.id })\r\n\tticketList.value = res.records || []\r\n\tselectedTicketIndex.value = 0\r\n\t// 获取票务列表后立即计算价格\r\n\tif (ticketList.value.length > 0) {\r\n\t\tcalculatePrice()\r\n\t\t// 检查是否需要显示滚动提示\r\n\t\tcheckScrollIndicator()\r\n\t}\r\n}\r\n\r\n// 检查是否需要显示滚动提示\r\nconst checkScrollIndicator = () => {\r\n\t// 如果票务列表超过3个，显示滚动提示\r\n\tif (ticketList.value.length > 3) {\r\n\t\tshowScrollIndicator.value = true\r\n\t\tcanScrollDown.value = true\r\n\t\t// 3秒后自动隐藏提示\r\n\t\tsetTimeout(() => {\r\n\t\t\tshowScrollIndicator.value = false\r\n\t\t}, 3000)\r\n\t}\r\n}\r\n\r\n// 处理票务列表滚动事件\r\nconst onTicketScroll = (e) => {\r\n\tconst { scrollTop, scrollHeight, clientHeight } = e.detail\r\n\t// 隐藏滚动提示\r\n\tif (showScrollIndicator.value) {\r\n\t\tshowScrollIndicator.value = false\r\n\t}\r\n\t// 判断是否可以继续向下滚动\r\n\tcanScrollDown.value = scrollTop + clientHeight < scrollHeight - 10\r\n}\r\n\r\n// 判断文本是否需要截断\r\nconst isTextTruncated = (text) => {\r\n\treturn text && text.length > MAX_DESC_LENGTH\r\n}\r\n\r\n// 获取显示的文本内容\r\nconst getDisplayText = (text, index) => {\r\n\tif (!text) return ''\r\n\tif (!isTextTruncated(text)) return text\r\n\tif (expandedTickets.value[index]) return text\r\n\treturn text.substring(0, MAX_DESC_LENGTH) + '...'\r\n}\r\n\r\n// 切换文本展开/收起状态\r\nconst toggleExpand = (index) => {\r\n\texpandedTickets.value[index] = !expandedTickets.value[index]\r\n}\r\n\r\n// 咨询客服 - 修改为显示二维码\r\nconst contactService = () => {\r\n\tif (themeDetail.value.serviceQrUrl) {\r\n\t\tisQrModalVisible.value = true\r\n\t} else {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '客服暂不可用',\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// 新增：隐藏二维码弹窗\r\nconst hideQrModal = () => {\r\n\tisQrModalVisible.value = false\r\n}\r\n\r\n// 显示购票弹窗\r\nconst showTicketModal = () => {\r\n\tisModalVisible.value = true\r\n\tgetTicketList()\r\n}\r\n\r\n// 隐藏弹窗\r\nconst hideModal = () => {\r\n\tisModalVisible.value = false\r\n\t// 隐藏弹窗时重置所有展开状态\r\n\texpandedTickets.value = {}\r\n}\r\n\r\n// 选择票务\r\nconst selectTicket = (index) => {\r\n\tselectedTicketIndex.value = index\r\n\t// 先收起所有已展开的票务详情\r\n\texpandedTickets.value = {}\r\n\t// 如果票务详情需要截断，自动展开当前选中的票务\r\n\tconst ticket = ticketList.value[index]\r\n\tif (ticket && isTextTruncated(ticket.details)) {\r\n\t\texpandedTickets.value[index] = true\r\n\t}\r\n}\r\n\r\n// 增加数量\r\nconst increaseQuantity = () => {\r\n\tquantity.value++\r\n}\r\n\r\n// 减少数量\r\nconst decreaseQuantity = () => {\r\n\tif (quantity.value > 1) {\r\n\t\tquantity.value--\r\n\t}\r\n}\r\n\r\n// 计算价格（统一处理价格计算逻辑）\r\nconst calculatePrice = async () => {\r\n\t// 基础价格计算\r\n\tif (ticketList.value.length === 0) {\r\n\t\ttotalPrice.value = 0\r\n\t\treturn\r\n\t}\r\n\tconst selectedTicket = ticketList.value[selectedTicketIndex.value]\r\n\tif (!selectedTicket) {\r\n\t\ttotalPrice.value = 0\r\n\t\treturn\r\n\t}\r\n\t\r\n\t// 构建价格计算参数\r\n\tconst params = {\r\n\t\tticketId: selectedTicket.id,\r\n\t\tquantity: quantity.value\r\n\t}\r\n\t\r\n\t// TODO: 调用后端接口计算实时价格\r\n\t// 可以在这里添加后端接口调用，例如：\r\n\t// try {\r\n\t//   const res = await priceAPI.calculate(params)\r\n\t//   totalPrice.value = res.totalPrice\r\n\t//   return\r\n\t// } catch (error) {\r\n\t//   console.error('计算价格失败:', error)\r\n\t//   // 接口调用失败时使用本地计算\r\n\t// }\r\n\t\r\n\t// 本地价格计算（可作为接口调用失败的备选方案）\r\n\tconst price = selectedTicket?.currentPrice ? new Decimal(selectedTicket.currentPrice).div(100) : new Decimal(0)\r\n\tconst calculatedPrice = price.mul(quantity.value).toNumber()\r\n\t\r\n\t// 更新totalPrice的值\r\n\ttotalPrice.value = calculatedPrice\r\n\t\r\n\t// 调试日志\r\n\tconsole.log('计算价格:', {\r\n\t\t...params,\r\n\t\ttotalPrice: calculatedPrice\r\n\t})\r\n}\r\n\r\n// 购买票务\r\nconst purchaseTicket = async () => {\r\n\tif (isPurchasing.value || isLoading.value) return // 防止重复点击\r\n\t\r\n\tisPurchasing.value = true\r\n\tisLoading.value = true // 显示全屏loading\r\n\t\r\n\ttry {\r\n\t\tconst selectedTicket = ticketList.value[selectedTicketIndex.value]\r\n\r\n\t\t// 获取FromSalesId作为salespersonId\r\n\t\tconst fromSalesId = getFromSalesId()\r\n\t\t\r\n\t\tconst orderData = {\r\n\t\t\toutTradePlatform: 'wechat_applet',\r\n\t\t\tamountPaid: new Decimal(totalPrice.value).mul(100).toNumber(),\r\n\t\t\torderSku: [{\r\n\t\t\t\tticketId: selectedTicket.id,\r\n\t\t\t\tquantity: quantity.value,\r\n\t\t\t}]\r\n\t\t}\r\n\t\t\r\n\t\t// 如果有FromSalesId，则添加salespersonId\r\n\t\tif (fromSalesId) {\r\n\t\t\torderData.salespersonId = fromSalesId\r\n\t\t}\r\n\t\t\r\n\t\tconst result = await orderAPI.create(orderData);\r\n\r\n\t\tconst { nonceStr, prepayId, signType, paySign, timeStamp } = result;\r\n\t\tuni.requestPayment({\r\n\t\t\tprovider:'wxpay',\r\n\t\t\ttimeStamp,\r\n\t\t\tnonceStr,\r\n\t\t\tpackage:`prepay_id=${prepayId}`,\r\n\t\t\tsignType: signType,\r\n\t\t\tpaySign: paySign,\r\n\t\t\tsuccess(responseData) {\r\n\t\t\t\tisPurchasing.value = false\r\n\t\t\t\tisLoading.value = false\r\n\t\t\t\t\r\n\t\t\t\tif(responseData.errMsg === 'requestPayment:ok'){\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '支付成功！',\r\n\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl:`/pages/ECommerce/pages/order-list?tradeStatus=40`\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 2000)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '支付取消',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl:`/pages/ECommerce/pages/order-list?tradeStatus=10`\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 2000)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail(error) {\r\n\t\t\t\tisPurchasing.value = false\r\n\t\t\t\tisLoading.value = false\r\n\t\t\t\t\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '支付失败',\r\n\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\tduration: 2000\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl:`/pages/ECommerce/pages/order-list?tradeStatus=10`\r\n\t\t\t\t\t})\r\n\t\t\t\t}, 2000)\r\n\t\t\t}\r\n\t\t})\r\n\t} catch (error) {\r\n\t\tisPurchasing.value = false\r\n\t\tisLoading.value = false\r\n\t\t\r\n\t\tconsole.error('购票失败:', error)\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '购票失败，请重试',\r\n\t\t\ticon: 'error',\r\n\t\t\tduration: 2000\r\n\t\t})\r\n\t}\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.content {\r\n\tbackground-color: #f5f5f5;\r\n\tpadding-bottom: 160rpx; /* 为底部操作栏留出空间 */\r\n}\r\n\r\n.theme-poster {\r\n\twidth: 100%;\r\n\theight: 720rpx;\r\n\tposition: relative;\r\n\toverflow: hidden;\r\n}\r\n\r\n.poster-image {\r\n\twidth: 100%;\r\n}\r\n\r\n\r\n\r\n.theme-content {\r\n\tpadding: 30rpx 0;\r\n\tbackground-color: #fff;\r\n\tmargin-top: 20rpx;\r\n\tmargin-bottom: 20rpx; /* 增加底部间距 */\r\n}\r\n\r\n.theme-title {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tdisplay: block;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.theme-description {\r\n\tfont-size: 28rpx;\r\n\tline-height: 1.6;\r\n\tdisplay: block;\r\n}\r\n\r\n/* 底部操作栏 */\r\n.bottom-action-bar {\r\n\tposition: fixed;\r\n\tbottom: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbackground: linear-gradient(135deg, #4a4a3a 0%, #6b6b4a 100%);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n\tpadding: 30rpx 30rpx env(safe-area-inset-bottom);\r\n\tbox-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\r\n\tz-index: 1000;\r\n}\r\n\r\n.customer-service {\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\twidth: 180rpx;\r\n\theight: 80rpx;\r\n}\r\n\r\n.service-icon {\r\n\twidth: 64rpx;\r\n\theight: 64rpx;\r\n\tmargin-right: 12rpx;\r\n}\r\n\r\n.service-text {\r\n\tfont-size: 26rpx;\r\n\tcolor: #d4c5a0;\r\n}\r\n\r\n.buy-button {\r\n\twidth: 300rpx;\r\n\theight: 80rpx;\r\n\tbackground: linear-gradient(135deg, #d4c5a0 0%, #b8a082 100%);\r\n\tborder-radius: 40rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tbox-shadow: 0 4rpx 15rpx rgba(212, 197, 160, 0.3);\r\n}\r\n\r\n.buy-text {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #4a4a3a;\r\n}\r\n\r\n/* 购票弹窗 */\r\n.ticket-modal {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tbackground-color: rgba(0, 0, 0, 0.6);\r\n\tdisplay: flex;\r\n\talign-items: flex-end;\r\n\tz-index: 2000;\r\n}\r\n\r\n.modal-content {\r\n\twidth: 100%;\r\n\tmax-height: 80vh;\r\n\tbackground: linear-gradient(135deg, #4a4a3a 0%, #6b6b4a 100%);\r\n\tborder-radius: 40rpx 40rpx 0 0;\r\n\tpadding: 40rpx 30rpx env(safe-area-inset-bottom);\r\n\tcolor: #d4c5a0;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.modal-title {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #d4c5a0;\r\n}\r\n\r\n/* 票务选择容器 */\r\n.ticket-selection-container {\r\n\tflex: 1;\r\n\tposition: relative;\r\n\tmargin-bottom: 40rpx;\r\n}\r\n\r\n/* 票务选择 */\r\n.ticket-selection {\r\n\theight: 100%;\r\n\tmax-height: 50vh;\r\n\toverflow-y: auto;\r\n\tpadding-right: 10rpx;\r\n}\r\n\r\n.ticket-item {\r\n\tbackground-color: rgba(212, 197, 160, 0.1);\r\n\tborder: 2rpx solid transparent;\r\n\tborder-radius: 20rpx;\r\n\tpadding: 30rpx;\r\n\tmargin-bottom: 20rpx;\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.ticket-item.selected {\r\n\tbackground-color: rgba(212, 197, 160, 0.2);\r\n\tborder-color: #d4c5a0;\r\n\tbox-shadow: 0 4rpx 15rpx rgba(212, 197, 160, 0.2);\r\n}\r\n\r\n.ticket-info {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 15rpx;\r\n}\r\n\r\n.ticket-name {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #d4c5a0;\r\n}\r\n\r\n.ticket-price {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #d4c5a0;\r\n}\r\n\r\n.ticket-desc-container {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tgap: 8rpx;\r\n}\r\n\r\n.ticket-desc {\r\n\tfont-size: 24rpx;\r\n\tcolor: #b8a082;\r\n\tline-height: 1.4;\r\n\tword-break: break-all;\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.ticket-desc.expanded {\r\n\tmax-height: none;\r\n}\r\n\r\n.expand-btn {\r\n\tfont-size: 22rpx;\r\n\tcolor: #d4c5a0;\r\n\ttext-decoration: underline;\r\n\talign-self: flex-start;\r\n\tpadding: 4rpx 0;\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.expand-btn:active {\r\n\tcolor: #b8a082;\r\n\ttransform: scale(0.95);\r\n}\r\n\r\n/* 购买数量 */\r\n.quantity-section {\r\n\tmargin-bottom: 40rpx;\r\n\tflex-shrink: 0;\r\n}\r\n\r\n.section-title {\r\n\tfont-size: 28rpx;\r\n\tcolor: #d4c5a0;\r\n\tmargin-bottom: 20rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.quantity-control {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tgap: 40rpx;\r\n}\r\n\r\n.quantity-btn {\r\n\twidth: 60rpx;\r\n\theight: 60rpx;\r\n\tborder-radius: 50%;\r\n\tbackground-color: rgba(212, 197, 160, 0.2);\r\n\tborder: 2rpx solid #d4c5a0;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.quantity-btn:active {\r\n\tbackground-color: rgba(212, 197, 160, 0.4);\r\n\ttransform: scale(0.95);\r\n}\r\n\r\n.btn-text {\r\n\tfont-weight: bold;\r\n\tcolor: #d4c5a0;\r\n}\r\n\r\n.quantity-text {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #d4c5a0;\r\n\tmin-width: 60rpx;\r\n\ttext-align: center;\r\n}\r\n\r\n/* 底部操作 */\r\n.modal-footer {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n\tpadding-top: 30rpx;\r\n\tborder-top: 2rpx solid rgba(212, 197, 160, 0.2);\r\n\tflex-shrink: 0;\r\n}\r\n\r\n.total-price {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: flex-start;\r\n}\r\n\r\n.price-label {\r\n\tfont-size: 24rpx;\r\n\tcolor: #b8a082;\r\n\tmargin-bottom: 8rpx;\r\n}\r\n\r\n.price-value {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #d4c5a0;\r\n}\r\n\r\n.purchase-btn {\r\n\twidth: 300rpx;\r\n\theight: 80rpx;\r\n\tbackground: linear-gradient(135deg, #d4c5a0 0%, #b8a082 100%);\r\n\tborder-radius: 40rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tbox-shadow: 0 4rpx 15rpx rgba(212, 197, 160, 0.3);\r\n\ttransition: all 0.3s ease;\r\n}\r\n\r\n.purchase-btn:active {\r\n\ttransform: scale(0.98);\r\n}\r\n\r\n.purchase-btn.loading {\r\n\topacity: 0.7;\r\n\tpointer-events: none;\r\n\tbackground: linear-gradient(135deg, #b8a082 0%, #a08f72 100%);\r\n}\r\n\r\n.purchase-text {\r\n\tfont-size: 28rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #4a4a3a;\r\n}\r\n\r\n/* 客服二维码弹窗样式 */\r\n.qr-modal {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tbackground-color: rgba(0, 0, 0, 0.6);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tz-index: 2000;\r\n}\r\n\r\n.qr-modal-content {\r\n\twidth: 550rpx;\r\n\tpadding: 40rpx;\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n}\r\n\r\n.qr-image-container {\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.qr-image {\r\n\twidth: 450rpx;\r\n\theight: 450rpx;\r\n\tborder-radius: 20rpx;\r\n}\r\n\r\n.qr-tip {\r\n\tfont-size: 28rpx;\r\n\tcolor: #ffffff;\r\n\tfont-weight: bold;\r\n\ttext-align: center;\r\n\tdisplay: block;\r\n}\r\n\r\n/* 全屏loading遮罩样式 */\r\n.loading-overlay {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tbackground-color: rgba(0, 0, 0, 0.7);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tz-index: 9999;\r\n}\r\n\r\n.loading-content {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\twidth: 200rpx;\r\n\theight: 200rpx;\r\n\tpadding: 40rpx;\r\n\tbackground-color: rgba(255, 255, 255, 0.95);\r\n\tborder-radius: 20rpx;\r\n\tbox-shadow: 0 8rpx 30rpx rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.loading-spinner {\r\n\twidth: 80rpx;\r\n\theight: 80rpx;\r\n\tborder: 6rpx solid #f3f3f3;\r\n\tborder-top: 6rpx solid #d4c5a0;\r\n\tborder-radius: 50%;\r\n\tanimation: spin 1s linear infinite;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n@keyframes spin {\r\n\t0% { transform: rotate(0deg); }\r\n\t100% { transform: rotate(360deg); }\r\n}\r\n\r\n.loading-text {\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tfont-weight: 500;\r\n\ttext-align: center;\r\n}\r\n\r\n/* 滚动提示样式 */\r\n.scroll-indicator {\r\n\tposition: absolute;\r\n\tbottom: 20rpx;\r\n\tleft: 50%;\r\n\ttransform: translateX(-50%);\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\tbackground: rgba(0, 0, 0, 0.6);\r\n\tborder-radius: 30rpx;\r\n\tpadding: 15rpx 25rpx;\r\n\tz-index: 10;\r\n\tanimation: fadeInOut 3s ease-in-out;\r\n}\r\n\r\n.scroll-text {\r\n\tfont-size: 22rpx;\r\n\tcolor: #ffffff;\r\n\tmargin-bottom: 8rpx;\r\n}\r\n\r\n.scroll-arrow {\r\n\tfont-size: 24rpx;\r\n\tcolor: #ffffff;\r\n\tanimation: bounce 1.5s infinite;\r\n}\r\n\r\n/* 底部渐变遮罩 */\r\n.scroll-gradient {\r\n\tposition: absolute;\r\n\tbottom: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\theight: 60rpx;\r\n\tbackground: linear-gradient(to top, rgba(74, 74, 58, 0.8) 0%, transparent 100%);\r\n\tpointer-events: none;\r\n\tz-index: 5;\r\n}\r\n\r\n/* 动画效果 */\r\n@keyframes fadeInOut {\r\n\t0% { opacity: 0; transform: translateX(-50%) translateY(10rpx); }\r\n\t20% { opacity: 1; transform: translateX(-50%) translateY(0); }\r\n\t80% { opacity: 1; transform: translateX(-50%) translateY(0); }\r\n\t100% { opacity: 0; transform: translateX(-50%) translateY(-10rpx); }\r\n}\r\n\r\n@keyframes bounce {\r\n\t0%, 20%, 50%, 80%, 100% { transform: translateY(0); }\r\n\t40% { transform: translateY(-8rpx); }\r\n\t60% { transform: translateY(-4rpx); }\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/wangshuli/workspace/mine/pighand/pighand-AIO/client-applet/pages/ECommerce/pages/theme.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","watch","onLoad","themeAPI","uni","ticketAPI","Decimal","getFromSalesId","orderAPI"],"mappings":"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"}