# 通用组件使用指南

## 组件概览

项目提供了一套完整的通用组件，用于快速构建管理界面：

- **PDataManager**: 数据管理组件（核心组件）
- **PSearch**: 搜索组件
- **PDataTable**: 数据表格组件
- **PDrawer**: 抽屉组件
- **FormItems**: 表单项组件
- **其他辅助组件**: Button、Dialog、Divider等

## PDataManager - 数据管理组件

### 组件说明

`PDataManager` 是项目的核心组件，集成了搜索、表格、详情编辑等功能，提供完整的CRUD操作界面。

### 基本用法

```vue
<template>
    <PDataManager
        :handle-query="api.query"
        :handle-find="api.find"
        :handle-delete="api.del"
        :handle-create="api.create"
        :handle-update="api.update">
    </PDataManager>
</template>

<script lang="ts" setup>
import { api } from '@/api';
import provideForm from '@/common/provideForm';

// 配置表单字段
const {} = provideForm([
    // 字段配置...
]);
</script>
```

### 属性配置

#### 显示控制属性

```vue
<PDataManager
    :is-show-search="true"      <!-- 是否显示搜索组件 -->
    :is-show-data-table="true"  <!-- 是否显示数据表格 -->
    :is-show-drawer="true"      <!-- 是否显示详情抽屉 -->
    <!-- 其他属性... -->
>
</PDataManager>
```

#### CRUD操作处理函数

```vue
<PDataManager
    :handle-query="api.query"        <!-- 查询列表 -->
    :handle-find="api.find"          <!-- 查询单个 -->
    :handle-delete="api.del"         <!-- 删除 -->
    :handle-create="api.create"      <!-- 创建 -->
    :handle-update="api.update"      <!-- 更新 -->
    :handle-format-data="formatData" <!-- 数据格式化 -->
>
</PDataManager>
```

#### 子组件属性配置

```vue
<PDataManager
    :search-props="searchConfig"      <!-- 搜索组件配置 -->
    :data-table-props="tableConfig"   <!-- 表格组件配置 -->
    :drawer-props="drawerConfig"      <!-- 抽屉组件配置 -->
>
</PDataManager>
```

### 插槽使用

#### 表格操作列插槽

```vue
<template #table-column-operation="{ row }">
    <el-button
        size="small"
        type="primary"
        @click="customAction(row)">
        自定义操作
    </el-button>
    <el-button
        size="small"
        type="danger"
        @click="deleteItem(row)">
        删除
    </el-button>
</template>
```

#### 表格列自定义插槽

```vue
<!-- 自定义状态列显示 -->
<template #table-column-status="{ row }">
    <el-tag :type="row.status === 1 ? 'success' : 'danger'">
        {{ row.status === 1 ? '启用' : '禁用' }}
    </el-tag>
</template>

<!-- 自定义图片列显示 -->
<template #table-column-image="{ row }">
    <el-image
        :src="row.imageUrl"
        :preview-src-list="[row.imageUrl]"
        style="width: 50px; height: 50px;"
        fit="cover">
    </el-image>
</template>
```

#### 搜索表单插槽

```vue
<!-- 自定义搜索项 -->
<template #search-dateRange="{ formModel }">
    <el-date-picker
        v-model="formModel.dateRange"
        type="daterange"
        range-separator="至"
        start-placeholder="开始日期"
        end-placeholder="结束日期">
    </el-date-picker>
</template>
```

#### 详情表单插槽

```vue
<!-- 自定义详情表单项 -->
<template #detail-customField="{ formModel }">
    <custom-component v-model="formModel.customField" />
</template>

<!-- 详情页面额外内容 -->
<template #detail-float>
    <div class="extra-content">
        <h3>额外配置</h3>
        <!-- 额外的表单内容 -->
    </div>
</template>
```

## PSearch - 搜索组件

### 基本用法

```vue
<template>
    <PSearch
        :handle-query="handleSearch"
        :search-props="searchConfig">
        
        <!-- 自定义搜索项 -->
        <template #search-customField="{ formModel }">
            <custom-search-component v-model="formModel.customField" />
        </template>
    </PSearch>
</template>

<script lang="ts" setup>
const handleSearch = async (params: any) => {
    // 处理搜索逻辑
    const result = await api.query(params);
    return result;
};

const searchConfig = {
    // 搜索组件配置
};
</script>
```

### 搜索配置示例

```typescript
const searchConfig = {
    // 搜索按钮文本
    searchButtonText: '搜索',
    // 重置按钮文本
    resetButtonText: '重置',
    // 是否显示更多搜索项
    showMore: true,
    // 默认显示的搜索项数量
    defaultShowCount: 3
};
```

## PDataTable - 数据表格组件

### 基本用法

```vue
<template>
    <PDataTable
        :handle-query="api.query"
        :handle-find="api.find"
        :handle-delete="api.del"
        :table-props="tableConfig">
        
        <!-- 自定义表格列 -->
        <template #table-column-operation="{ row }">
            <el-button @click="editRow(row)">编辑</el-button>
        </template>
    </PDataTable>
</template>
```

### 表格配置示例

```typescript
const tableConfig = {
    // 是否显示序号列
    showIndex: true,
    // 是否显示选择列
    showSelection: true,
    // 表格大小
    size: 'default',
    // 是否显示边框
    border: true,
    // 是否显示斑马纹
    stripe: true,
    // 分页配置
    pagination: {
        pageSize: 20,
        pageSizes: [10, 20, 50, 100]
    }
};
```

## PDrawer - 抽屉组件

### 基本用法

```vue
<template>
    <PDrawer
        :handle-create="api.create"
        :handle-update="api.update"
        :handle-query="api.query"
        :drawer-props="drawerConfig">
        
        <!-- 自定义表单项 -->
        <template #detail-customField="{ formModel }">
            <custom-form-component v-model="formModel.customField" />
        </template>
        
        <!-- 额外内容 -->
        <template #detail-float>
            <div class="extra-section">
                <!-- 额外的表单内容 -->
            </div>
        </template>
    </PDrawer>
</template>
```

### 抽屉配置示例

```typescript
const drawerConfig = {
    // 抽屉标题
    title: '编辑信息',
    // 抽屉宽度
    size: '50%',
    // 是否显示关闭按钮
    showClose: true,
    // 点击遮罩是否关闭
    closeOnClickModal: false,
    // 按ESC是否关闭
    closeOnPressEscape: true
};
```

## FormItems - 表单项组件

### 基本用法

```vue
<template>
    <FormItems
        :form-model="formData"
        :form-columns="formColumns"
        :form-type="'detail'">
        
        <!-- 自定义表单项 -->
        <template #detail-customField="{ formModel }">
            <custom-input v-model="formModel.customField" />
        </template>
    </FormItems>
</template>

<script lang="ts" setup>
import { ref } from 'vue';

const formData = ref({
    name: '',
    email: '',
    customField: ''
});

const formColumns = [
    {
        label: '姓名',
        prop: 'name',
        isDetail: true,
        rules: [{ required: true, message: '姓名必填' }]
    },
    {
        label: '邮箱',
        prop: 'email',
        isDetail: true,
        domType: 'input',
        inputType: 'email'
    },
    {
        label: '自定义字段',
        prop: 'customField',
        isDetail: true
    }
];
</script>
```

## 其他通用组件

### Button - 按钮组件

```vue
<template>
    <!-- 基础按钮 -->
    <PButton type="primary" @click="handleClick">
        确定
    </PButton>
    
    <!-- 带图标的按钮 -->
    <PButton type="success" :icon="Check">
        保存
    </PButton>
    
    <!-- 加载状态按钮 -->
    <PButton :loading="isLoading" @click="handleSubmit">
        {{ isLoading ? '提交中...' : '提交' }}
    </PButton>
</template>
```

### Dialog - 对话框组件

```vue
<template>
    <PDialog
        v-model="dialogVisible"
        title="确认操作"
        width="500px">
        
        <p>确定要执行此操作吗？</p>
        
        <template #footer>
            <PButton @click="dialogVisible = false">取消</PButton>
            <PButton type="primary" @click="confirmAction">确定</PButton>
        </template>
    </PDialog>
</template>
```

### ImageView - 图片查看组件

```vue
<template>
    <ImageView
        :src="imageUrl"
        :preview-src-list="imageList"
        style="width: 100px; height: 100px;"
        fit="cover">
    </ImageView>
</template>
```

## 高级用法示例

### 复杂的数据管理页面

```vue
<template>
    <PDataManager
        :handle-query="product.query"
        :handle-find="product.find"
        :handle-delete="product.del"
        :handle-create="product.create"
        :handle-update="product.update"
        :handle-format-data="formatProductData">
        
        <!-- 自定义搜索区域 -->
        <template #search-priceRange="{ formModel }">
            <div class="price-range">
                <el-input-number
                    v-model="formModel.minPrice"
                    placeholder="最低价格"
                    :min="0">
                </el-input-number>
                <span style="margin: 0 10px;">-</span>
                <el-input-number
                    v-model="formModel.maxPrice"
                    placeholder="最高价格"
                    :min="0">
                </el-input-number>
            </div>
        </template>
        
        <!-- 自定义表格操作列 -->
        <template #table-column-operation="{ row }">
            <el-button
                v-if="row.status === 0"
                size="small"
                type="success"
                @click="enableProduct(row)">
                启用
            </el-button>
            <el-button
                v-if="row.status === 1"
                size="small"
                type="warning"
                @click="disableProduct(row)">
                禁用
            </el-button>
            <el-button
                size="small"
                type="primary"
                @click="viewDetails(row)">
                查看详情
            </el-button>
        </template>
        
        <!-- 自定义状态列 -->
        <template #table-column-status="{ row }">
            <el-tag :type="getStatusType(row.status)">
                {{ getStatusText(row.status) }}
            </el-tag>
        </template>
        
        <!-- 自定义价格列 -->
        <template #table-column-price="{ row }">
            <span class="price">¥{{ row.price.toFixed(2) }}</span>
        </template>
        
        <!-- 详情页面额外内容 -->
        <template #detail-float>
            <div class="product-extra">
                <h3>商品规格</h3>
                <el-form>
                    <el-form-item label="重量">
                        <el-input v-model="extraData.weight" suffix="kg" />
                    </el-form-item>
                    <el-form-item label="尺寸">
                        <el-input v-model="extraData.size" />
                    </el-form-item>
                </el-form>
            </div>
        </template>
    </PDataManager>
</template>

<script lang="ts" setup>
import { ref } from 'vue';
import { product } from '@/api';
import provideForm from '@/common/provideForm';
import { ElMessage } from 'element-plus';

// 额外数据
const extraData = ref({
    weight: '',
    size: ''
});

// 表单配置
const { getDetailOperation, queryTableData } = provideForm([
    // 表单字段配置...
]);

// 数据格式化
const formatProductData = (data: any) => {
    // 对数据进行格式化处理
    return {
        ...data,
        formattedPrice: `¥${data.price?.toFixed(2) || '0.00'}`
    };
};

// 状态相关方法
const getStatusType = (status: number) => {
    const typeMap = {
        0: 'danger',
        1: 'success',
        2: 'warning'
    };
    return typeMap[status] || 'info';
};

const getStatusText = (status: number) => {
    const textMap = {
        0: '禁用',
        1: '启用',
        2: '待审核'
    };
    return textMap[status] || '未知';
};

// 操作方法
const enableProduct = async (row: any) => {
    const id = getDetailOperation(row).primaryValue;
    await product.updateStatus(id, 1);
    ElMessage.success('启用成功');
    await refreshData();
};

const disableProduct = async (row: any) => {
    const id = getDetailOperation(row).primaryValue;
    await product.updateStatus(id, 0);
    ElMessage.success('禁用成功');
    await refreshData();
};

const viewDetails = (row: any) => {
    // 查看详情逻辑
    console.log('查看详情:', row);
};

const refreshData = async () => {
    await queryTableData(async (params: any) => {
        return await product.query(params);
    });
};
</script>

<style scoped>
.price-range {
    display: flex;
    align-items: center;
}

.price {
    font-weight: bold;
    color: #e6a23c;
}

.product-extra {
    margin-top: 20px;
    padding: 20px;
    background-color: #f5f7fa;
    border-radius: 4px;
}
</style>
```

## 最佳实践

### 1. 组件复用

```vue
<!-- 创建可复用的业务组件 -->
<template>
    <PDataManager v-bind="commonProps">
        <template #table-column-operation="{ row }">
            <slot name="operations" :row="row">
                <!-- 默认操作按钮 -->
                <el-button size="small" @click="$emit('edit', row)">
                    编辑
                </el-button>
            </slot>
        </template>
    </PDataManager>
</template>
```

### 2. 事件处理

```vue
<script lang="ts" setup>
// 定义事件
const emit = defineEmits(['refresh', 'edit', 'delete']);

// 处理事件
const handleEdit = (row: any) => {
    emit('edit', row);
};

const handleDelete = async (row: any) => {
    await api.delete(row.id);
    emit('refresh');
};
</script>
```

### 3. 性能优化

```vue
<script lang="ts" setup>
import { computed, shallowRef } from 'vue';

// 使用计算属性优化渲染
const tableColumns = computed(() => {
    return formColumns.filter(col => col.isTable);
});

// 使用shallowRef优化大数据
const tableData = shallowRef([]);
</script>
```

## 注意事项

1. **插槽命名**: 插槽名称必须严格按照规范，如 `table-column-[prop]`、`search-[prop]`、`detail-[prop]`
2. **数据响应性**: 确保传递给组件的数据具有正确的响应性
3. **事件处理**: 合理使用事件机制，避免组件间的紧耦合
4. **性能考虑**: 对于大量数据，考虑使用虚拟滚动或分页
5. **类型安全**: 在TypeScript项目中，为组件属性定义正确的类型
6. **样式隔离**: 使用scoped样式避免样式污染

通过合理使用这些通用组件，可以大大提高开发效率，保持代码的一致性和可维护性。